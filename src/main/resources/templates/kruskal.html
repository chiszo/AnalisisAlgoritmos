<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Kruskal - Árbol de Expansión Mínima</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/inicio}">Algoritmos</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">PC 1</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" th:href="@{/inicio}">Casos</a></li>
                        <li><a class="dropdown-item" th:href="@{/burbuja}">Burbuja</a></li>
                        <li><a class="dropdown-item" th:href="@{/insercion}">Inserción</a></li>
                        <li><a class="dropdown-item" th:href="@{/seleccion}">Selección</a></li>
                        <li><a class="dropdown-item" th:href="@{/quicksort}">QuickSort</a></li>
                        <li><a class="dropdown-item" th:href="@{/mergesort}">MergeSort</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">PC 2</a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" th:href="@{/cambioMoneda}">Cambio de Moneda</a></li>
                        <li><a class="dropdown-item" th:href="@{/agenteViajero}">Agente Viajero</a></li>
                        <li><a class="dropdown-item" th:href="@{/permutaciones}">Permutaciones</a></li>
                        <li><a class="dropdown-item" th:href="@{/dijkstra}">Dijkstra</a></li>
                        <li><a class="dropdown-item" th:href="@{/kruskal}">Kruskal</a></li>
                        <li><a class="dropdown-item" th:href="@{/recursivos}">Recursivos</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">PC 3</a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" th:href="@{/mochila}">Mochila</a></li>
                        <li><a class="dropdown-item" th:href="@{/floyd}">Floyd</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <h2 class="text-center mb-4">Algoritmo de Kruskal</h2>

    <div class="card p-4 shadow-sm">
        <form id="kruskalForm">
            <div class="mb-3">
                <label for="matriz" class="form-label">Matriz de adyacencia</label>
                <textarea id="matriz" name="matriz" rows="5" class="form-control" placeholder="Ejemplo:
0 2 6 0 0
2 0 3 8 5
0 3 0 0 7
6 8 0 0 9
0 5 7 9 0" required></textarea>
            </div>
            <button type="button" class="btn btn-primary" onclick="calcularKruskal()">Calcular Árbol Mínimo</button>
        </form>

        <div id="mensaje" class="mt-3"></div>

        <div id="resultado" class="mt-4"></div>
    </div>
</div>

<script>
    function mostrarMensaje(texto, tipo = "danger") {
        document.getElementById("mensaje").innerHTML = `
            <div class="alert alert-${tipo}" role="alert">${texto}</div>`;
    }

    function calcularKruskal() {
        const input = document.getElementById("matriz").value.trim();
        document.getElementById("mensaje").innerHTML = ""; // limpiar mensaje anterior
        document.getElementById("resultado").innerHTML = "";

        if (!input) {
            mostrarMensaje("Por favor, ingrese una matriz válida.");
            return;
        }

        const rows = input.split("\n").map(r => r.trim().split(/[ ,]+/).map(Number));
        const n = rows.length;

        if (!rows.every(r => r.length === n)) {
            mostrarMensaje("La matriz debe ser cuadrada (mismo número de filas y columnas).");
            return;
        }

        const edges = [];
        for (let i = 0; i < n; i++) {
            for (let j = i + 1; j < n; j++) {
                const peso = rows[i][j];
                if (peso > 0) edges.push({ origen: i, destino: j, peso });
            }
        }

        if (edges.length === 0) {
            mostrarMensaje("No hay aristas válidas en la matriz.");
            return;
        }

        edges.sort((a, b) => a.peso - b.peso);

        const parent = Array.from({ length: n }, (_, i) => i);
        const find = x => (parent[x] === x ? x : (parent[x] = find(parent[x])));
        const union = (x, y) => parent[find(x)] = find(y);

        const resultado = [];
        let pesoTotal = 0;

        for (const e of edges) {
            const raizU = find(e.origen);
            const raizV = find(e.destino);
            if (raizU !== raizV) {
                resultado.push(e);
                pesoTotal += e.peso;
                union(raizU, raizV);
            }
        }

        let html = `<h5>Árbol de Expansión Mínima</h5>
                <table class="table table-bordered text-center mt-3">
                    <thead class="table-dark"><tr><th>Arista</th><th>Peso</th></tr></thead><tbody>`;
        resultado.forEach(a => {
            html += `<tr><td>(${a.origen} - ${a.destino})</td><td>${a.peso}</td></tr>`;
        });
        html += `</tbody></table><div class="alert alert-info text-center">
             <strong>Peso total:</strong> ${pesoTotal}
             </div>`;

        document.getElementById("resultado").innerHTML = html;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
